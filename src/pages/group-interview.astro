---
import config from "@/config/config.json";
import theme from "@/config/theme.json";
import { plainify } from "@/lib/utils/textConverter";
import "@/styles/main.scss";
import { AstroFont } from "astro-font";
import "aos/dist/aos.css";
import GroupInterviewForm from "@/components/GroupInterviewForm";

const pf = theme.fonts.font_family.primary;
const sf = theme.fonts.font_family.secondary;

let fontPrimary, fontSecondary;
if (theme.fonts.font_family.primary) {
  fontPrimary = theme.fonts.font_family.primary
    .replace(/\+/g, " ")
    .replace(/:[ital,]*[ital@]*[wght@]*[0-9,;.]+/gi, "");
}
if (theme.fonts.font_family.secondary) {
  fontSecondary = theme.fonts.font_family.secondary
    .replace(/\+/g, " ")
    .replace(/:[ital,]*[ital@]*[wght@]*[0-9,;.]+/gi, "");
}

const title = "Group Interview Registration";
const meta_title = "Group Interview Registration | ThisWay Global";
const description =
  "Register for a ThisWay Global group interview session. Select your preferred date and time slot.";
---

<!doctype html>
<html lang="en">
  <head>
    <link rel="shortcut icon" href={config.site.favicon} />
    <meta name="theme-color" content="#fff" />
    <meta name="generator" content={Astro.generator} />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <AstroFont
      config={[
        {
          src: [],
          preload: false,
          display: "swap",
          name: fontPrimary!,
          fallback: "sans-serif",
          cssVariable: "font-primary",
          googleFontsURL: `https://fonts.googleapis.com/css2?family=${pf}&display=swap`,
        },
        {
          src: [],
          preload: false,
          display: "swap",
          name: fontSecondary!,
          fallback: "sans-serif",
          cssVariable: "font-secondary",
          googleFontsURL: `https://fonts.googleapis.com/css2?family=${sf}&display=swap`,
        },
      ]}
    />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=5"
    />
    <title>{plainify(meta_title)}</title>
    <meta name="description" content={plainify(description)} />
    <meta property="og:title" content={plainify(meta_title)} />
    <meta property="og:description" content={plainify(description)} />
    <meta property="og:type" content="website" />
  </head>
  <body class="min-h-screen bg-theme-light">
    <header class="py-8 text-center">
      <a href="/" class="inline-block">
        <img
          src="/images/logo.svg"
          alt="ThisWay Global"
          class="mx-auto h-10"
        />
      </a>
    </header>

    <main class="px-4 pb-16">
      <div class="mx-auto max-w-2xl">
        <div class="mb-10 text-center" data-aos="fade-up-sm" data-aos-delay="100">
          <h1 class="mb-4 text-3xl font-semibold text-dark sm:text-4xl">
            Congratulations!
          </h1>
          <p class="mx-auto max-w-xl text-base text-light">
            We're glad you're here! Based on your application, we'd love to move
            forward and invite you to the next step of our interview process.
            Please select a date and time that works best for you.
          </p>
        </div>

        <div data-aos="fade-up-sm" data-aos-delay="400">
          <GroupInterviewForm client:load />
        </div>
      </div>
    </main>

    <script>
      import AOS from "aos";
      function aosInit() {
        AOS.init({ duration: 600, once: true });
      }
      aosInit();
      document.addEventListener("astro:after-swap", aosInit);

      // Confetti on page load
      (function confetti() {
        const canvas = document.createElement("canvas");
        canvas.style.cssText =
          "position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999";
        document.body.appendChild(canvas);
        const ctx = canvas.getContext("2d")!;
        let w = (canvas.width = window.innerWidth);
        let h = (canvas.height = window.innerHeight);
        window.addEventListener("resize", () => {
          w = canvas.width = window.innerWidth;
          h = canvas.height = window.innerHeight;
        });

        const colors = ["#5969FC", "#24ab9d", "#FBBC05", "#EA4335", "#34A853", "#0A0A0A"];
        const pieces: {
          x: number;
          y: number;
          w: number;
          h: number;
          color: string;
          vx: number;
          vy: number;
          rot: number;
          rv: number;
          opacity: number;
        }[] = [];

        for (let i = 0; i < 120; i++) {
          pieces.push({
            x: Math.random() * w,
            y: Math.random() * -h,
            w: Math.random() * 8 + 4,
            h: Math.random() * 4 + 2,
            color: colors[Math.floor(Math.random() * colors.length)],
            vx: (Math.random() - 0.5) * 3,
            vy: Math.random() * 3 + 2,
            rot: Math.random() * 360,
            rv: (Math.random() - 0.5) * 8,
            opacity: 1,
          });
        }

        let frame = 0;
        const maxFrames = 180;

        function draw() {
          frame++;
          ctx.clearRect(0, 0, w, h);

          const fadeStart = maxFrames * 0.6;
          for (const p of pieces) {
            p.x += p.vx;
            p.y += p.vy;
            p.vy += 0.04;
            p.rot += p.rv;
            if (frame > fadeStart) {
              p.opacity = Math.max(0, 1 - (frame - fadeStart) / (maxFrames - fadeStart));
            }

            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate((p.rot * Math.PI) / 180);
            ctx.globalAlpha = p.opacity;
            ctx.fillStyle = p.color;
            ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
            ctx.restore();
          }

          if (frame < maxFrames) {
            requestAnimationFrame(draw);
          } else {
            canvas.remove();
          }
        }
        requestAnimationFrame(draw);
      })();
    </script>
  </body>
</html>
